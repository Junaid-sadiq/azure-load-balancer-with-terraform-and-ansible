# Auto-generated from Terraform outputs
# Load ngx_stream_module
load_module /usr/lib/nginx/modules/ngx_stream_module.so;

events {
    worker_connections 8192;
}

stream {
    # Log file settings
    log_format dns '$remote_addr - - [$time_local] $protocol $status $bytes_sent $bytes_received $session_time "$upstream_addr"';
    access_log /var/log/nginx/access.log dns;
    error_log /var/log/nginx/error.log;

    upstream backend_servers {
        server 10.0.1.5:80;  # VM-2
        server 10.0.1.4:80;  # VM-3
        server 10.0.1.6:80;  # VM-4
    }

    server {
        listen 80;                    # Nginx load balancer listen port 80
        proxy_pass backend_servers;   # The server group backend_servers
    }
}
